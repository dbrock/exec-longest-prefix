#!/bin/bash
set -e -o pipefail
source plz-util.sh

if ! test -d ${LIBEXEC:?}; then
  error "no such directory: $LIBEXEC"
fi

if test $# = 0; then
  set -- --default-command
fi

function maybe-custom-fallback-command {
  test -e "$LIBEXEC"/--no-such-command &&
  echo --no-such-command $(shell-quote "$@")
}

plz-parse-longest-prefix "$@" ||
maybe-custom-fallback-command "$@" ||
error no such command: $(shell-quote "$@")
